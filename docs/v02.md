# v02 — InfoChannel Architecture

Main Objective: Feed-centric MCP server with pluggable InfoChannel adapters.

## What was done

Replaced v01's flat RSS-only code with the full InfoChannel architecture:

- **3 channel types**: RSS, YouTube Podcast, GitHub Trends
- **7 MCP tools**: get_feed, get_channel_types, list/create/update/delete_channel, sync_channel
- **Pluggable adapter system**: new channel types require zero core changes
- **Background sync**: SyncCoordinator with TTL-based scheduling, concurrency control, rate budget tracking
- **Channel CRUD**: full lifecycle management via MCP tools
- **Introspection**: `get_channel_types` returns registered types with self-described config schemas

## Architecture

The app is centered around the **Feed** — a unified stream of `NormalizedItem` from heterogeneous sources.

### Layers

- **MCP Layer** (`mcp/tools.ts`, `mcp/render.ts`): thin tool definitions + text rendering
- **Core Layer** (`core/`): FeedService orchestrator, SyncCoordinator, AdapterRegistry
- **Store Layer** (`stores/`): ChannelStore, ItemStore, SyncStateStore
- **Adapter Layer** (`adapters/`): RssAdapter, YouTubePodcastAdapter, GitHubTrendsAdapter

### Key contracts

- `NormalizedItem` — the atom of the feed (id, channelId, channelType, title, url, publishedAt, snippet, author?, meta?)
- `InfoChannel` — a configured source (id, type, name, enabled, config, tags)
- `ChannelAdapter` — the plugin interface (type, displayName, describeConfig, validate, sync)
- `SyncCursor` — opaque per-channel state for incremental sync

### Sync model

- Background loop: ticks every 30s, syncs stale channels in parallel
- On-demand: `get_feed` calls `ensureFresh`, `sync_channel` forces immediate refresh
- Concurrency: global semaphore (8) + per-adapter semaphore
- Rate budget: per-adapter tracking from API response headers
- Error handling: exponential backoff, circuit breaker after 5 failures

## Project structure

```
src/
  index.ts
  core/
    types.ts
    feed-service.ts
    sync-coordinator.ts
    adapter-registry.ts
  stores/
    channel-store.ts
    item-store.ts
    sync-state-store.ts
  adapters/
    rss.ts
    youtube-podcast.ts
    github-trends.ts
  mcp/
    tools.ts
    render.ts
```
